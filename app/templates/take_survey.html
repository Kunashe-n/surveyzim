{% extends "layout.html" %}

{% block title %}
    {% if preview %}Preview Survey{% else %}Take Survey - {{ survey.title }}{% endif %}
{% endblock %}

{% block content %}
<div class="container" style="padding: 20px 0">
    <div class="neu-card">
        <!-- Add logo display here -->
        {% if survey.logo_filename %}
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="{{ url_for('static', filename='survey_logos/' + survey.logo_filename) }}" 
                 alt="Survey Logo" 
                 style="max-height: 120px; max-width: 250px; border-radius: 8px;">
        </div>
        {% endif %}
        <h2 class="page-title">
            {% if preview %}Preview: {% endif %}{{ survey.title }}
        </h2>
        <p>{{ survey.description }}</p>

        {% if preview %}
        <div style="padding: 10px; background: rgba(0,0,0,0.05); border-radius: 10px; margin-bottom: 20px;">
            <i class="fas fa-info-circle"></i> You are viewing a preview. Responses will <strong>not</strong> be submitted.
        </div>
        {% endif %}

        {% if not preview %}
        <form method="POST" action="{{ url_for('main.submit_survey_response', survey_id=survey.id) }}">
        {% endif %}

            {% set is_disabled = preview %}
            {% set is_required = not preview %}

            {% for question in questions %}
            <div class="neu-card question-item" style="margin-bottom: 20px; padding: 20px;">
                <div class="form-group">
                    <label><strong>{{ loop.index }}. {{ question.text }}</strong>{% if question.required and not preview %} *{% endif %}</label>
                    
                    {% if question.qtype == 'linear_scale' %}
                    <!-- Linear Scale Question -->
                    <div class="linear-scale">
                        <div class="linear-scale-labels d-flex justify-content-between mb-2">
                            <span class="low-label text-muted">{{ question.linear_scale_low_label or question.linear_scale_low }}</span>
                            <span class="high-label text-muted">{{ question.linear_scale_high_label or question.linear_scale_high }}</span>
                        </div>
                        <div class="linear-scale-options d-flex justify-content-between">
                            {% for i in range(question.linear_scale_low, question.linear_scale_high + 1) %}
                                <label class="linear-scale-option text-center">
                                    <input type="radio" name="question_{{ question.id }}" value="{{ i }}" 
                                           {% if question.required and not preview %}required{% endif %}
                                           {% if preview %}disabled{% endif %} class="form-check-input">
                                    <span class="d-block mt-1">{{ i }}</span>
                                </label>
                            {% endfor %}
                        </div>
                    </div>

                    {% elif question.qtype == "short" %}
                        <input type="text" name="question_{{ question.id }}" class="neu-input"
                               {% if preview %}disabled{% endif %}
                               {% if question.required and not preview %}required{% endif %}>

                    {% elif question.qtype == "paragraph" %}
                        <textarea name="question_{{ question.id }}" class="neu-input" rows="4"
                                  {% if preview %}disabled{% endif %}
                                  {% if question.required and not preview %}required{% endif %}></textarea>

                    {% elif question.qtype == "multiple_choice" %}
                        {% if question.options %}
                            {% for option in question.options %}
                            <div style="margin: 10px 0;">
                                <input type="radio" 
                                       name="question_{{ question.id }}" 
                                       value="{{ option.text }}"
                                       id="mc_{{ question.id }}_{{ option.id }}"
                                       {% if preview %}disabled{% endif %}
                                       {% if question.required and not preview %}required{% endif %}>
                                <label for="mc_{{ question.id }}_{{ option.id }}">{{ option.text }}</label>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p style="color: #ff6b6b; font-style: italic; padding: 10px; background: #fff5f5;">
                                ⚠️ No options configured for this multiple choice question.
                            </p>
                        {% endif %}

                    {% elif question.qtype == "checkbox" %}
                        {% if question.options %}
                            {% for option in question.options %}
                            <div style="margin: 10px 0;">
                                <input type="checkbox"
                                       name="question_{{ question.id }}"
                                       value="{{ option.text }}"
                                       id="cb_{{ question.id }}_{{ option.id }}"
                                       {% if preview %}disabled{% endif %}>
                                <label for="cb_{{ question.id }}_{{ option.id }}">{{ option.text }}</label>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p style="color: #ff6b6b; font-style: italic; padding: 10px; background: #fff5f5;">
                                ⚠️ No options configured for this checkbox question.
                            </p>
                        {% endif %}

                    {% elif question.qtype == "dropdown" %}
                        {% if question.options %}
                            <select name="question_{{ question.id }}" class="neu-input"
                                    {% if preview %}disabled{% endif %}
                                    {% if question.required and not preview %}required{% endif %}>
                                <option value="">Select an option</option>
                                {% for option in question.options %}
                                <option value="{{ option.text }}">{{ option.text }}</option>
                                {% endfor %}
                            </select>
                        {% else %}
                            <p style="color: #ff6b6b; font-style: italic; padding: 10px; background: #fff5f5;">
                                ⚠️ No options configured for this dropdown question.
                            </p>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            {% if not preview %}
            <div class="form-actions">
                <button type="submit" class="neu-btn neu-btn-primary">
                    <i class="fas fa-paper-plane"></i> Submit Survey
                </button>
            </div>
            </form>
            {% endif %}

            {% if preview %}
            <div class="form-actions">
                <a href="{{ url_for('main.survey_view', survey_id=survey.id) }}" class="neu-btn neu-btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Survey Editor
                </a>
            </div>
            {% endif %}
    </div>
</div>

<style>
.linear-scale-options {
    gap: 10px;
}

.linear-scale-option {
    flex: 1;
    padding: 5px;
}

.linear-scale-option input[type="radio"] {
    margin: 0 auto;
    display: block;
}

.linear-scale-option span {
    font-size: 0.9em;
    color: #666;
}
</style>
{% endblock %}